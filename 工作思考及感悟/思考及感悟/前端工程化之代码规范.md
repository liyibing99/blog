# 前端工程化之代码规范

代码规范是前端工程化的重要组成部分，良好的代码规范能够提高代码质量、降低维护成本、提升团队协作效率。本文将全面介绍前端代码规范的各个方面。

## 为什么需要代码规范

### 代码规范的价值

1. **提高代码质量**：统一的风格使代码更易读、易维护
2. **降低维护成本**：减少理解代码的时间
3. **提升团队效率**：减少代码审查和合并冲突
4. **减少 bug**：规范化的代码更容易发现问题
5. **便于自动化**：统一的风格便于工具处理

## JavaScript/TypeScript 规范

### 1. 命名规范

#### 变量和函数命名

```javascript
// 使用驼峰命名法
const userName = 'John'
const isLoggedIn = true

// 函数使用动词开头
function getUserData() { }
function handleSubmit() { }
function isValidEmail() { }

// 布尔值使用 is/has/can 前缀
const isActive = true
const hasPermission = false
const canEdit = true

// 私有变量使用下划线前缀
class User {
  constructor() {
    this._id = null
    this._name = ''
  }
}
```

#### 常量命名

```javascript
// 使用全大写和下划线
const API_BASE_URL = 'https://api.example.com'
const MAX_RETRY_COUNT = 3
const DEFAULT_PAGE_SIZE = 10

// 常量使用 const 声明
const CONFIG = {
  API_URL: 'https://api.example.com',
  TIMEOUT: 5000
}
```

#### 类命名

```javascript
// 使用帕斯卡命名法
class UserService { }
class HttpClient { }
class AuthProvider { }

// 接口命名
interface IUser { }
interface IApiResponse { }
```

### 2. 代码风格

#### 缩进和空格

```javascript
// 使用 2 个空格缩进
function example() {
  if (condition) {
    doSomething()
  }
}

// 对象和数组使用空格
const obj = { key: 'value' }
const arr = [1, 2, 3]

// 运算符两侧使用空格
const sum = a + b
const result = condition ? value1 : value2
```

#### 分号

```javascript
// 始终使用分号
const name = 'John'
const age = 30

function greet() {
  console.log('Hello')
}
```

#### 引号

```javascript
// 优先使用单引号
const name = 'John'
const message = 'Hello, World!'

// 字符串中包含单引号时使用双引号
const quote = "It's a beautiful day"

// 模板字符串
const greeting = `Hello, ${name}!`
```

### 3. 函数规范

#### 函数声明

```javascript
// 使用函数表达式或箭头函数
const add = (a, b) => a + b

// 多行函数使用大括号
const calculateTotal = (items) => {
  return items.reduce((sum, item) => sum + item.price, 0)
}

// 参数默认值
function greet(name = 'Guest') {
  console.log(`Hello, ${name}!`)
}

// 参数解构
function createUser({ name, email, age }) {
  return { name, email, age }
}
```

#### 函数长度

```javascript
// 函数应该保持简短，通常不超过 20 行
// 如果函数过长，考虑拆分成多个小函数

// 好的例子
function validateEmail(email) {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
  return emailRegex.test(email)
}

function validatePassword(password) {
  return password.length >= 8
}

function validateForm(email, password) {
  return validateEmail(email) && validatePassword(password)
}
```

#### 参数数量

```javascript
// 参数数量不超过 3 个
// 如果参数过多，使用对象

// 不好的例子
function createUser(name, email, age, address, phone) { }

// 好的例子
function createUser({ name, email, age, address, phone }) { }
```

### 4. 异步代码规范

#### Promise

```javascript
// 使用 async/await 而不是 .then()
async function fetchData() {
  try {
    const response = await fetch('/api/data')
    const data = await response.json()
    return data
  } catch (error) {
    console.error('Error fetching data:', error)
    throw error
  }
}

// 并行请求
async function fetchMultipleData() {
  const [users, posts] = await Promise.all([
    fetch('/api/users'),
    fetch('/api/posts')
  ])
  return {
    users: await users.json(),
    posts: await posts.json()
  }
}
```

#### 错误处理

```javascript
// 始终处理错误
async function processData() {
  try {
    const data = await fetchData()
    return processData(data)
  } catch (error) {
    console.error('Processing failed:', error)
    throw new Error('Failed to process data')
  }
}

// 错误对象
class ValidationError extends Error {
  constructor(message) {
    super(message)
    this.name = 'ValidationError'
  }
}
```

## CSS/SCSS 规范

### 1. 命名规范

#### BEM 命名法

```css
/* Block */
.card { }

/* Element */
.card__header { }
.card__body { }
.card__footer { }

/* Modifier */
.card--primary { }
.card--secondary { }

/* 组合使用 */
.card__header--highlight { }
```

#### 类名规范

```css
/* 使用 kebab-case */
.my-component { }
.my-component__element { }
.my-component--modifier { }

/* 避免使用 ID 选择器 */
/* 不推荐 */
#header { }

/* 推荐 */
.header { }
```

### 2. 代码组织

#### 文件结构

```scss
// 1. 变量和混合
@import 'variables';
@import 'mixins';

// 2. 基础样式
@import 'reset';
@import 'typography';

// 3. 组件
@import 'buttons';
@import 'cards';
@import 'forms';

// 4. 布局
@import 'header';
@import 'footer';
@import 'sidebar';

// 5. 工具类
@import 'utilities';
```

#### 属性顺序

```scss
.card {
  // 1. 定位
  position: relative;
  top: 0;
  left: 0;

  // 2. 盒模型
  display: flex;
  width: 100%;
  height: auto;
  padding: 20px;
  margin: 0;

  // 3. 字体
  font-size: 16px;
  font-weight: normal;
  line-height: 1.5;
  color: #333;

  // 4. 背景
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 4px;

  // 5. 其他
  opacity: 1;
  transition: all 0.3s ease;
}
```

### 3. 响应式设计

```scss
// 使用断点变量
$breakpoint-mobile: 768px;
$breakpoint-tablet: 1024px;
$breakpoint-desktop: 1440px;

// 移动优先
.container {
  width: 100%;
  padding: 10px;

  @media (min-width: $breakpoint-tablet) {
    width: 90%;
    padding: 20px;
  }

  @media (min-width: $breakpoint-desktop) {
    width: 1200px;
    padding: 30px;
  }
}
```

## React/Vue 规范

### 1. 组件命名

```javascript
// React 组件使用帕斯卡命名法
function UserProfile() { }
class HomePage extends React.Component { }

// 文件名与组件名一致
// UserProfile.jsx
export default function UserProfile() { }
```

### 2. 组件结构

```javascript
// React 组件结构
import React, { useState, useEffect } from 'react'
import PropTypes from 'prop-types'
import { Button } from './Button'

function UserProfile({ userId }) {
  const [user, setUser] = useState(null)
  const [loading, setLoading] = useState(false)

  useEffect(() => {
    fetchUser(userId)
  }, [userId])

  const fetchUser = async (id) => {
    setLoading(true)
    try {
      const response = await fetch(`/api/users/${id}`)
      const data = await response.json()
      setUser(data)
    } catch (error) {
      console.error('Error fetching user:', error)
    } finally {
      setLoading(false)
    }
  }

  if (loading) {
    return <div>Loading...</div>
  }

  if (!user) {
    return <div>User not found</div>
  }

  return (
    <div className="user-profile">
      <h1>{user.name}</h1>
      <p>{user.email}</p>
      <Button onClick={() => console.log('Edit')}>Edit</Button>
    </div>
  )
}

UserProfile.propTypes = {
  userId: PropTypes.string.isRequired
}

export default UserProfile
```

### 3. Hooks 规范

```javascript
// Hooks 只在函数组件顶层调用
function MyComponent() {
  const [count, setCount] = useState(0)
  const [name, setName] = useState('')

  useEffect(() => {
    document.title = `Count: ${count}`
  }, [count])

  return <div>{count}</div>
}

// 自定义 Hook 命名以 use 开头
function useWindowSize() {
  const [size, setSize] = useState({
    width: window.innerWidth,
    height: window.innerHeight
  })

  useEffect(() => {
    const handleResize = () => {
      setSize({
        width: window.innerWidth,
        height: window.innerHeight
      })
    }

    window.addEventListener('resize', handleResize)
    return () => window.removeEventListener('resize', handleResize)
  }, [])

  return size
}
```

## 代码检查工具

### 1. ESLint

#### 配置

```javascript
// .eslintrc.js
module.exports = {
  env: {
    browser: true,
    es2021: true,
    node: true
  },
  extends: [
    'eslint:recommended',
    'plugin:react/recommended',
    'plugin:@typescript-eslint/recommended',
    'plugin:prettier/recommended'
  ],
  parser: '@typescript-eslint/parser',
  parserOptions: {
    ecmaFeatures: {
      jsx: true
    },
    ecmaVersion: 'latest',
    sourceType: 'module'
  },
  plugins: [
    'react',
    '@typescript-eslint',
    'import'
  ],
  rules: {
    'no-console': ['warn', { allow: ['warn', 'error'] }],
    'no-unused-vars': 'off',
    '@typescript-eslint/no-unused-vars': ['error', {
      argsIgnorePattern: '^_',
      varsIgnorePattern: '^_'
    }],
    'react/prop-types': 'off',
    'react/react-in-jsx-scope': 'off',
    'import/order': ['error', {
      groups: [
        'builtin',
        'external',
        'internal',
        'parent',
        'sibling',
        'index'
      ],
      'newlines-between': 'always'
    }]
  },
  settings: {
    react: {
      version: 'detect'
    }
  }
}
```

#### 忽略文件

```javascript
// .eslintignore
node_modules/
dist/
build/
coverage/
*.config.js
```

### 2. Prettier

#### 配置

```javascript
// .prettierrc.js
module.exports = {
  printWidth: 100,
  tabWidth: 2,
  useTabs: false,
  semi: true,
  singleQuote: true,
  quoteProps: 'as-needed',
  jsxSingleQuote: false,
  trailingComma: 'es5',
  bracketSpacing: true,
  bracketSameLine: false,
  arrowParens: 'always',
  requirePragma: false,
  insertPragma: false,
  proseWrap: 'preserve',
  htmlWhitespaceSensitivity: 'css',
  vueIndentScriptAndStyle: false,
  endOfLine: 'lf',
  embeddedLanguageFormatting: 'auto'
}
```

#### 忽略文件

```javascript
// .prettierignore
node_modules/
dist/
build/
coverage/
package-lock.json
pnpm-lock.yaml
```

### 3. Stylelint

#### 配置

```javascript
// .stylelintrc.js
module.exports = {
  extends: [
    'stylelint-config-standard',
    'stylelint-config-recommended-scss',
    'stylelint-config-prettier'
  ],
  rules: {
    'selector-class-pattern': '^[a-z][a-z0-9-]*$',
    'selector-pseudo-class-no-unknown': [
      true,
      {
        ignorePseudoClasses: ['global', 'local']
      }
    ],
    'selector-pseudo-element-no-unknown': [
      true,
      {
        ignorePseudoElements: ['v-deep', 'v-global', 'v-slotted']
      }
    ],
    'at-rule-no-unknown': [
      true,
      {
        ignoreAtRules: ['tailwind', 'apply', 'layer', 'variants', 'responsive', 'screen']
      }
    ],
    'no-descending-specificity': null,
    'scss/at-rule-no-unknown': [
      true,
      {
        ignoreAtRules: ['tailwind', 'apply', 'layer', 'variants', 'responsive', 'screen']
      }
    ]
  }
}
```

## Git 规范

### 1. 提交信息规范

#### Conventional Commits

```
<type>(<scope>): <subject>

<body>

<footer>
```

#### Type 类型

- `feat`: 新功能
- `fix`: 修复 bug
- `docs`: 文档更新
- `style`: 代码格式调整
- `refactor`: 重构
- `perf`: 性能优化
- `test`: 测试相关
- `chore`: 构建过程或辅助工具的变动
- `revert`: 回滚

#### 示例

```bash
# 新功能
git commit -m "feat(auth): add user login functionality"

# 修复 bug
git commit -m "fix(api): resolve data parsing error"

# 文档更新
git commit -m "docs(readme): update installation instructions"

# 重构
git commit -m "refactor(components): simplify user profile component"
```

### 2. 分支管理

#### 分支命名

```bash
# 功能分支
feature/user-authentication
feature/shopping-cart

# 修复分支
fix/login-bug
fix/payment-error

# 发布分支
release/v1.0.0
release/v2.0.0

# 热修复分支
hotfix/critical-security-fix
```

#### 工作流程

```bash
# 1. 从 develop 创建功能分支
git checkout develop
git checkout -b feature/new-feature

# 2. 开发并提交
git add .
git commit -m "feat: add new feature"

# 3. 推送到远程
git push origin feature/new-feature

# 4. 创建 Pull Request 到 develop

# 5. 合并后删除分支
git checkout develop
git branch -d feature/new-feature
```

## 文档规范

### 1. 代码注释

#### JSDoc

```javascript
/**
 * 计算两个数的和
 * @param {number} a - 第一个数
 * @param {number} b - 第二个数
 * @returns {number} 两数之和
 * @example
 * add(1, 2) // 返回 3
 */
function add(a, b) {
  return a + b
}

/**
 * 获取用户信息
 * @async
 * @param {string} userId - 用户 ID
 * @returns {Promise<User>} 用户信息
 * @throws {Error} 当用户不存在时抛出错误
 */
async function getUser(userId) {
  const response = await fetch(`/api/users/${userId}`)
  if (!response.ok) {
    throw new Error('User not found')
  }
  return response.json()
}
```

#### 组件注释

```javascript
/**
 * 用户资料组件
 * @component
 * @example
 * return (
 *   <UserProfile userId="123" />
 * )
 */
function UserProfile({ userId }) {
  // 组件实现
}
```

### 2. README 规范

```markdown
# 项目名称

简短的项目描述

## 功能特性

- 功能 1
- 功能 2
- 功能 3

## 安装

\`\`\`bash
npm install
\`\`\`

## 使用

\`\`\`bash
npm start
\`\`\`

## 开发

\`\`\`bash
npm run dev
\`\`\`

## 测试

\`\`\`bash
npm test
\`\`\`

## 构建

\`\`\`bash
npm run build
\`\`\`

## 贡献指南

欢迎贡献！请查看 [CONTRIBUTING.md](CONTRIBUTING.md) 了解详情。

## 许可证

MIT
```

## 最佳实践

### 1. 代码审查

```javascript
// 审查清单
// - 代码是否符合规范
// - 是否有必要的注释
// - 是否有重复代码
// - 是否有性能问题
// - 是否有安全漏洞
// - 测试是否充分
```

### 2. 重构原则

```javascript
// 重构前
function processUserData(data) {
  let result = []
  for (let i = 0; i < data.length; i++) {
    if (data[i].age > 18) {
      let user = {
        name: data[i].name,
        email: data[i].email
      }
      result.push(user)
    }
  }
  return result
}

// 重构后
function processUserData(data) {
  return data
    .filter(user => user.age > 18)
    .map(({ name, email }) => ({ name, email }))
}
```

### 3. 性能优化

```javascript
// 避免不必要的计算
const expensiveValue = useMemo(() => {
  return heavyComputation(data)
}, [data])

// 避免不必要的渲染
const memoizedComponent = React.memo(Component)

// 使用防抖和节流
const debouncedSearch = debounce(search, 300)
```

## 总结

代码规范是前端工程化的重要组成部分，需要：

1. **制定规范**：根据团队和项目需求制定合适的代码规范
2. **使用工具**：配置 ESLint、Prettier、Stylelint 等工具
3. **持续改进**：定期审查和更新规范
4. **团队协作**：确保团队成员都遵循规范
5. **自动化检查**：将代码检查集成到 CI/CD 流程中

通过建立完善的代码规范体系，可以大大提高代码质量和团队协作效率。记住，代码规范不是束缚，而是帮助团队写出更好代码的指南。